{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "9de57347",
   "metadata": {},
   "source": [
    "# Blazar-neutrino chance coincidence simulation\n",
    "\n",
    "We demonstrate how to run a simulation of a blazar population and diffuse neutrino flux that have no underlying connection. The simulation makes use of the configuration files provided with the package."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "9e049feb",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-18T22:38:56.644159Z",
     "iopub.status.busy": "2022-01-18T22:38:56.643627Z",
     "iopub.status.idle": "2022-01-18T22:39:00.360145Z",
     "shell.execute_reply": "2022-01-18T22:39:00.359199Z"
    }
   },
   "outputs": [],
   "source": [
    "from popsynth.utils.logging import quiet_mode\n",
    "from icecube_tools.detector.effective_area import EffectiveArea\n",
    "from icecube_tools.detector.energy_resolution import EnergyResolution\n",
    "from icecube_tools.detector.angular_resolution import AngularResolution\n",
    "\n",
    "from nu_coincidence.blazar_nu.coincidence import BlazarNuCoincidenceSim\n",
    "from nu_coincidence.blazar_nu.coincidence import BlazarNuCoincidenceResults\n",
    "from nu_coincidence.utils.package_data import get_available_config\n",
    "\n",
    "quiet_mode()  # silence popsynth logs/output"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "126a9957",
   "metadata": {},
   "source": [
    "Firstly, we make sure that we have the necessary files for running an IceCube simulation by using the `icecube_tools` package"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "95294f9d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-18T22:39:00.367524Z",
     "iopub.status.busy": "2022-01-18T22:39:00.366647Z",
     "iopub.status.idle": "2022-01-18T22:41:02.129941Z",
     "shell.execute_reply": "2022-01-18T22:41:02.129454Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20181018_All-sky_point-source_IceCube_da...:   0%|          | 0/11730609 [00:00<?, ?it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20181018_All-sky_point-source_IceCube_da...:   9%|▉         | 1048576/11730609 [00:02<00:28, 368505.14it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20181018_All-sky_point-source_IceCube_da...:  18%|█▊        | 2097152/11730609 [00:04<00:20, 480042.84it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20181018_All-sky_point-source_IceCube_da...:  27%|██▋       | 3145728/11730609 [00:06<00:15, 566835.54it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20181018_All-sky_point-source_IceCube_da...:  36%|███▌      | 4194304/11730609 [00:07<00:11, 646118.18it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20181018_All-sky_point-source_IceCube_da...:  45%|████▍     | 5242880/11730609 [00:08<00:08, 732903.52it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20181018_All-sky_point-source_IceCube_da...:  54%|█████▎    | 6291456/11730609 [00:09<00:06, 784276.29it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20181018_All-sky_point-source_IceCube_da...:  63%|██████▎   | 7340032/11730609 [00:10<00:05, 787469.70it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20181018_All-sky_point-source_IceCube_da...:  72%|███████▏  | 8388608/11730609 [00:12<00:04, 759131.33it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20181018_All-sky_point-source_IceCube_da...:  80%|████████  | 9437184/11730609 [00:13<00:03, 749435.06it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20181018_All-sky_point-source_IceCube_da...:  89%|████████▉ | 10485760/11730609 [00:15<00:01, 673533.77it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20181018_All-sky_point-source_IceCube_da...:  98%|█████████▊| 11534336/11730609 [00:17<00:00, 634960.57it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20181018_All-sky_point-source_IceCube_da...: 100%|██████████| 11730609/11730609 [00:17<00:00, 633441.69it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20181018_All-sky_point-source_IceCube_da...: 100%|██████████| 11730609/11730609 [00:17<00:00, 656032.86it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:   0%|          | 0/18812495 [00:00<?, ?it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:   6%|▌         | 1048576/18812495 [00:02<00:37, 473728.34it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:  11%|█         | 2097152/18812495 [00:03<00:27, 605967.60it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:  17%|█▋        | 3145728/18812495 [00:04<00:22, 688894.85it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:  22%|██▏       | 4194304/18812495 [00:06<00:23, 612636.81it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:  28%|██▊       | 5242880/18812495 [00:08<00:22, 600592.07it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:  33%|███▎      | 6291456/18812495 [00:09<00:18, 670985.09it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:  39%|███▉      | 7340032/18812495 [00:11<00:15, 732652.64it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:  45%|████▍     | 8388608/18812495 [00:12<00:13, 793747.30it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:  50%|█████     | 9437184/18812495 [00:13<00:13, 709099.78it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:  56%|█████▌    | 10485760/18812495 [00:15<00:12, 646886.36it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:  61%|██████▏   | 11534336/18812495 [00:17<00:11, 652105.17it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:  67%|██████▋   | 12582912/18812495 [00:19<00:09, 633756.06it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:  72%|███████▏  | 13631488/18812495 [00:20<00:08, 640188.03it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:  78%|███████▊  | 14680064/18812495 [00:22<00:06, 601421.80it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:  84%|████████▎ | 15728640/18812495 [00:24<00:04, 646245.61it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:  89%|████████▉ | 16777216/18812495 [00:25<00:03, 674992.74it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...:  95%|█████████▍| 17825792/18812495 [00:26<00:01, 704653.57it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...: 100%|██████████| 18812495/18812495 [00:27<00:00, 772318.74it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20131121_Search_for_contained_neutrino_e...: 100%|██████████| 18812495/18812495 [00:27<00:00, 674772.17it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:   0%|          | 0/43711022 [00:00<?, ?it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:   2%|▏         | 1048576/43711022 [00:01<00:44, 952568.01it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:   5%|▍         | 2097152/43711022 [00:01<00:36, 1138661.25it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:   7%|▋         | 3145728/43711022 [00:02<00:31, 1269241.70it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  10%|▉         | 4194304/43711022 [00:03<00:30, 1277054.20it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  12%|█▏        | 5242880/43711022 [00:04<00:30, 1269827.39it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  14%|█▍        | 6291456/43711022 [00:04<00:28, 1316282.27it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  17%|█▋        | 7340032/43711022 [00:05<00:28, 1292251.20it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  19%|█▉        | 8388608/43711022 [00:06<00:27, 1293016.32it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  22%|██▏       | 9437184/43711022 [00:07<00:29, 1143153.58it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  24%|██▍       | 10485760/43711022 [00:08<00:30, 1087728.77it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  26%|██▋       | 11534336/43711022 [00:09<00:28, 1116177.68it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  29%|██▉       | 12582912/43711022 [00:10<00:27, 1129750.13it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  31%|███       | 13631488/43711022 [00:11<00:27, 1092095.57it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  34%|███▎      | 14680064/43711022 [00:13<00:34, 834277.76it/s] "
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  36%|███▌      | 15728640/43711022 [00:15<00:37, 744514.86it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  38%|███▊      | 16777216/43711022 [00:16<00:37, 719417.63it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  41%|████      | 17825792/43711022 [00:18<00:33, 764198.06it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  43%|████▎     | 18874368/43711022 [00:19<00:29, 840765.32it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  46%|████▌     | 19922944/43711022 [00:20<00:27, 873195.22it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  48%|████▊     | 20971520/43711022 [00:21<00:25, 884496.89it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  50%|█████     | 22020096/43711022 [00:22<00:24, 888374.44it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  53%|█████▎    | 23068672/43711022 [00:23<00:24, 843633.22it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  55%|█████▌    | 24117248/43711022 [00:24<00:22, 877605.63it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  58%|█████▊    | 25165824/43711022 [00:26<00:20, 896327.05it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  60%|█████▉    | 26214400/43711022 [00:27<00:20, 849090.62it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  62%|██████▏   | 27262976/43711022 [00:28<00:19, 841659.93it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  65%|██████▍   | 28311552/43711022 [00:29<00:17, 899903.67it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  67%|██████▋   | 29360128/43711022 [00:30<00:14, 960408.96it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  70%|██████▉   | 30408704/43711022 [00:32<00:15, 834492.15it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  72%|███████▏  | 31457280/43711022 [00:33<00:15, 787260.79it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  74%|███████▍  | 32505856/43711022 [00:35<00:16, 699091.42it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  77%|███████▋  | 33554432/43711022 [00:36<00:13, 732440.05it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  79%|███████▉  | 34603008/43711022 [00:37<00:11, 810841.33it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  82%|████████▏ | 35651584/43711022 [00:38<00:08, 904243.82it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  84%|████████▍ | 36700160/43711022 [00:39<00:07, 965506.04it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  86%|████████▋ | 37748736/43711022 [00:40<00:06, 968052.07it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  89%|████████▉ | 38797312/43711022 [00:41<00:04, 1012743.14it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  91%|█████████ | 39845888/43711022 [00:42<00:03, 1073652.88it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  94%|█████████▎| 40894464/43711022 [00:43<00:02, 1173211.85it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  96%|█████████▌| 41943040/43711022 [00:44<00:01, 1203457.37it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...:  98%|█████████▊| 42991616/43711022 [00:44<00:00, 1250130.17it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...: 100%|██████████| 43711022/43711022 [00:45<00:00, 1264184.38it/s]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\r",
      "20150820_Astrophysical_muon_neutrino_flu...: 100%|██████████| 43711022/43711022 [00:45<00:00, 963705.97it/s] "
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    }
   ],
   "source": [
    "my_aeff = EffectiveArea.from_dataset(\"20181018\")\n",
    "my_aeff = EffectiveArea.from_dataset(\"20131121\")\n",
    "my_eres = EnergyResolution.from_dataset(\"20150820\")\n",
    "my_angres = AngularResolution.from_dataset(\"20181018\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "8613b077",
   "metadata": {},
   "source": [
    "The inputs to `BlazarNuCoincidenceSim` are specified by the `.yml` config files provided with the `nu_coincidence` package. We can check what is available using the helper function `get_available_config()`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "e1c78722",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-18T22:41:02.134593Z",
     "iopub.status.busy": "2022-01-18T22:41:02.134111Z",
     "iopub.status.idle": "2022-01-18T22:41:02.141129Z",
     "shell.execute_reply": "2022-01-18T22:41:02.140524Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "['nu_connected_ehe.yml',\n",
       " 'nu_diffuse_ehe_soft.yml',\n",
       " 'fsrq_low.yml',\n",
       " 'fsrq_ref.yml',\n",
       " 'bllac_high.yml',\n",
       " 'bllac_nobcu.yml',\n",
       " 'nu_diffuse_tracks.yml',\n",
       " 'nu_connected_hese.yml',\n",
       " 'nu_diffuse_hese_soft.yml',\n",
       " 'fsrq_high.yml',\n",
       " 'bllac_rbcu.yml',\n",
       " 'nu_diffuse_ehe.yml',\n",
       " 'bllac_ref.yml',\n",
       " 'fsrq_gpsel.yml',\n",
       " 'fsrq_nobcu.yml',\n",
       " 'nu_diffuse_hese.yml',\n",
       " 'bllac_gpsel.yml',\n",
       " 'nu_connected_tracks.yml',\n",
       " 'nu_diffuse_ehe_hard.yml',\n",
       " 'fsrq_rbcu.yml',\n",
       " 'bllac_low.yml',\n",
       " 'nu_diffuse_hese_hard.yml']"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "get_available_config()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6356b48c",
   "metadata": {},
   "source": [
    "For this example, we can use the reference blazar model (`bllac_ref.yml` and `fsrq_ref.yml`) together with the diffuse IceCube HESE and EHE alerts models (`nu_diffuse_hese.yml` and `nu_diffuse_ehe.yml`)."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "f776c61f",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-18T22:41:02.145382Z",
     "iopub.status.busy": "2022-01-18T22:41:02.144921Z",
     "iopub.status.idle": "2022-01-18T22:43:18.080579Z",
     "shell.execute_reply": "2022-01-18T22:43:18.080081Z"
    }
   },
   "outputs": [],
   "source": [
    "sim = BlazarNuCoincidenceSim(\n",
    "    file_name=\"output/test_coincidence_sim.h5\",  # output file name\n",
    "    N=2,  # number of independent simulations to run\n",
    "    bllac_config=\"bllac_ref.yml\",\n",
    "    fsrq_config=\"fsrq_ref.yml\",\n",
    "    nu_hese_config=\"nu_diffuse_hese.yml\",\n",
    "    nu_ehe_config=\"nu_diffuse_ehe.yml\",\n",
    "    seed=42,\n",
    ")\n",
    "\n",
    "sim.run(parallel=False)  # define number of parallel jobs to run"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c43269fa",
   "metadata": {},
   "source": [
    "The results are organised to store relevant information on the number of different coincidences, divided into the `results.bllac` and `results.fsrq` populations. We study *spatial*, *variable* and *flaring* coincidences. In just 2 simulations, we expect to see spatial and variable coincidences, but flaring coincidences are unlikely. In the event that flaring coincidences occur, several other population/neutrino properties are also stored for further analysis."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "1f3c6674",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-18T22:43:18.085582Z",
     "iopub.status.busy": "2022-01-18T22:43:18.084624Z",
     "iopub.status.idle": "2022-01-18T22:43:18.092936Z",
     "shell.execute_reply": "2022-01-18T22:43:18.093295Z"
    }
   },
   "outputs": [],
   "source": [
    "results = BlazarNuCoincidenceResults.load([\"output/test_coincidence_sim.h5\"])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "71f63fdc",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-18T22:43:18.099533Z",
     "iopub.status.busy": "2022-01-18T22:43:18.099052Z",
     "iopub.status.idle": "2022-01-18T22:43:18.101461Z",
     "shell.execute_reply": "2022-01-18T22:43:18.101833Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "OrderedDict([('n_spatial', array([ 5., 15.])),\n",
       "             ('n_spatial_astro', array([1., 5.])),\n",
       "             ('n_variable', array([0., 1.])),\n",
       "             ('n_variable_astro', array([0., 0.])),\n",
       "             ('n_flaring', array([0., 0.])),\n",
       "             ('n_flaring_astro', array([0., 0.])),\n",
       "             ('matched_flare_amplitudes', array([], dtype=float64)),\n",
       "             ('matched_nu_ras', []),\n",
       "             ('matched_nu_decs', []),\n",
       "             ('matched_nu_ang_errs', []),\n",
       "             ('matched_nu_times', []),\n",
       "             ('pop_ras', []),\n",
       "             ('pop_decs', []),\n",
       "             ('pop_fluxes', [])])"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "results.bllac"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9442b16d",
   "metadata": {},
   "source": [
    "As we ran 4 simulations, we have a coincidence count for each case."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "91c471df",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-18T22:43:18.106886Z",
     "iopub.status.busy": "2022-01-18T22:43:18.106408Z",
     "iopub.status.idle": "2022-01-18T22:43:18.108767Z",
     "shell.execute_reply": "2022-01-18T22:43:18.109136Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([ 5., 15.])"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "results.bllac[\"n_spatial\"]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "45878097",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-18T22:43:18.114903Z",
     "iopub.status.busy": "2022-01-18T22:43:18.114427Z",
     "iopub.status.idle": "2022-01-18T22:43:18.116785Z",
     "shell.execute_reply": "2022-01-18T22:43:18.117154Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "OrderedDict([('n_spatial', array([2., 8.])),\n",
       "             ('n_spatial_astro', array([0., 4.])),\n",
       "             ('n_variable', array([0., 2.])),\n",
       "             ('n_variable_astro', array([0., 1.])),\n",
       "             ('n_flaring', array([0., 0.])),\n",
       "             ('n_flaring_astro', array([0., 0.])),\n",
       "             ('matched_flare_amplitudes', array([], dtype=float64)),\n",
       "             ('matched_nu_ras', []),\n",
       "             ('matched_nu_decs', []),\n",
       "             ('matched_nu_ang_errs', []),\n",
       "             ('matched_nu_times', []),\n",
       "             ('pop_ras', []),\n",
       "             ('pop_decs', []),\n",
       "             ('pop_fluxes', [])])"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "results.fsrq"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.9"
  },
  "widgets": {
   "application/vnd.jupyter.widget-state+json": {
    "state": {
     "3c1340e0f46149aa9873fe9fdeeb774f": {
      "model_module": "jupyter-vuetify",
      "model_module_version": "^1.8.1",
      "model_name": "ThemeColorsModel",
      "state": {
       "_model_module": "jupyter-vuetify",
       "_model_module_version": "^1.8.1",
       "_model_name": "ThemeColorsModel",
       "_theme_name": "light",
       "_view_count": null,
       "_view_module": null,
       "_view_module_version": "^1.8.1",
       "_view_name": null,
       "accent": "#82B1FF",
       "anchor": null,
       "error": "#FF5252",
       "info": "#2196F3",
       "primary": "#1976D2",
       "secondary": "#424242",
       "success": "#4CAF50",
       "warning": "#FB8C00"
      }
     },
     "49dcbfd20b1e4d649b44dff9f9647fd7": {
      "model_module": "jupyter-vuetify",
      "model_module_version": "^1.8.1",
      "model_name": "ThemeModel",
      "state": {
       "_model_module": "jupyter-vuetify",
       "_model_module_version": "^1.8.1",
       "_model_name": "ThemeModel",
       "_view_count": null,
       "_view_module": null,
       "_view_module_version": "^1.8.1",
       "_view_name": null,
       "dark": null
      }
     },
     "8622355d034e4f99b8b34c74f2c3acf7": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "e5aea1c39bdc41cf99745e30bd7228e5": {
      "model_module": "jupyter-vue",
      "model_module_version": "^1.7.0",
      "model_name": "ForceLoadModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "jupyter-vue",
       "_model_module_version": "^1.7.0",
       "_model_name": "ForceLoadModel",
       "_view_count": null,
       "_view_module": null,
       "_view_module_version": "",
       "_view_name": null,
       "layout": "IPY_MODEL_8622355d034e4f99b8b34c74f2c3acf7"
      }
     },
     "ee5874dab5e94019a4a4cc8c5ab5937d": {
      "model_module": "jupyter-vuetify",
      "model_module_version": "^1.8.1",
      "model_name": "ThemeColorsModel",
      "state": {
       "_model_module": "jupyter-vuetify",
       "_model_module_version": "^1.8.1",
       "_model_name": "ThemeColorsModel",
       "_theme_name": "dark",
       "_view_count": null,
       "_view_module": null,
       "_view_module_version": "^1.8.1",
       "_view_name": null,
       "accent": "#FF4081",
       "anchor": null,
       "error": "#FF5252",
       "info": "#2196F3",
       "primary": "#2196F3",
       "secondary": "#424242",
       "success": "#4CAF50",
       "warning": "#FB8C00"
      }
     }
    },
    "version_major": 2,
    "version_minor": 0
   }
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
